# Data Model: Backend RAG Chatbot API

## Entities

### Query
**Description**: A user's question or request for information, containing text content and optional context
**Fields**:
- `query_text` (string): The text content of the user's query
- `context` (optional string): Additional context provided with the query
- `user_id` (optional string): Identifier for the user making the query
- `timestamp` (datetime): When the query was submitted

### Textbook Content
**Description**: Structured educational material from the Physical AI & Humanoid Robotics textbook
**Fields**:
- `content_id` (string): Unique identifier for the content piece
- `title` (string): Title of the content section
- `text` (string): The actual content text
- `module` (string): Module identifier (e.g., "001-intro-physical-ai")
- `chapter` (string): Chapter identifier within the module
- `section` (string): Section identifier within the chapter
- `page_numbers` (optional string): Page range in the textbook
- `metadata` (JSON): Additional metadata about the content

### Embedding
**Description**: Vector representation of text content generated by Cohere API for semantic similarity matching
**Fields**:
- `embedding_id` (string): Unique identifier for the embedding
- `content_id` (string): Reference to the original content
- `vector` (array of floats): The embedding vector data
- `text_chunk` (string): The text that was embedded
- `chunk_index` (integer): Position of this chunk in the original content
- `created_at` (datetime): When the embedding was created

### Response
**Description**: Generated answer to user queries, containing relevant information and source citations
**Fields**:
- `response_id` (string): Unique identifier for the response
- `query_id` (string): Reference to the original query
- `answer_text` (string): The generated answer text
- `source_citations` (array of objects): List of source citations used
- `confidence_score` (float): Confidence level of the response (0-1)
- `timestamp` (datetime): When the response was generated
- `query_text` (string): The original query text

### Source Citation
**Description**: Reference to specific textbook content used in the response
**Fields**:
- `citation_id` (string): Unique identifier for the citation
- `content_id` (string): Reference to the textbook content
- `title` (string): Title of the cited content
- `text_excerpt` (string): Excerpt from the cited text
- `module` (string): Module identifier
- `chapter` (string): Chapter identifier
- `section` (string): Section identifier
- `relevance_score` (float): How relevant this source was to the query (0-1)

## Relationships

### Query → Response
- One-to-many: One query can generate multiple responses (for conversation history)
- Foreign key: `query_id` in Response references `query_id` in Query

### Textbook Content → Embedding
- One-to-many: One content piece can have multiple embeddings (for different chunks)
- Foreign key: `content_id` in Embedding references `content_id` in Textbook Content

### Response → Source Citation
- One-to-many: One response can reference multiple sources
- Foreign key: `response_id` in Source Citation references `response_id` in Response

### Embedding → Textbook Content
- Many-to-one: Multiple embeddings reference one content piece
- Foreign key: `content_id` in Embedding references `content_id` in Textbook Content

## Validation Rules

### Query Entity
- `query_text` must be between 1 and 1000 characters
- `query_text` must not be empty or contain only whitespace
- `context` is optional and can be up to 2000 characters

### Textbook Content Entity
- `content_id` must be unique across all content
- `text` must not be empty
- `module`, `chapter`, and `section` must follow the Docusaurus naming convention

### Embedding Entity
- `embedding_id` must be unique across all embeddings
- `vector` must have the correct dimension for the Cohere model being used
- `content_id` must reference an existing Textbook Content record

### Response Entity
- `answer_text` must not be empty
- `confidence_score` must be between 0 and 1
- `query_id` must reference an existing Query record

### Source Citation Entity
- `relevance_score` must be between 0 and 1
- `content_id` must reference an existing Textbook Content record
- Each response can have 1-5 source citations maximum

## State Transitions

### Query Processing Flow
1. **Pending**: Query received and being processed
2. **Processing**: Embeddings being retrieved and LLM being called
3. **Completed**: Response generated and returned to user
4. **Failed**: Error occurred during processing

### Content Status Flow
1. **Raw**: Content imported but not yet processed
2. **Chunked**: Content split into processable chunks
3. **Embedded**: Embeddings generated and stored
4. **Indexed**: Content ready for semantic search
